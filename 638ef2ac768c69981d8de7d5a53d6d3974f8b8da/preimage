=encoding utf8

=head1 NAME

perlcdelta - what is new for cperl v5.22.4

=head1 DESCRIPTION

This document describes perl-only differences between the cperl 5.22.3
release and the cperl 5.22.4 release.

For B<cperl> also see F<Changes> and L<perlcperl>

=head1 Security

=head2 DynaLoader format string hardening

Replace all C<%> characters in user-controlled library filenames, passed via
the system dl_error call verbatim to C<printf>, without any arguments on the stack,
which could lead to execution of arbitrary stack code. No CVE.
This affects all systems with dynamic loading where the attacker can cause a
dynamic loading error.

CVSSv2 Severity: 7.2 (AV:L/AC:L/Au:N/C:C/I:C/A:C/E:U/RL:OF/RC:C/CDP:MH/TD:H/CR:H/IR:H/AR:ND)

=head2 No Unicode confusables +UFFA0, +U3164

In deviation from Unicode 1.1 we treat the two HANGUL FILLER characters +UFFA0 and +U3164
not as valid ID_Start and ID_Continue characters for perl identifiers.
Variable and package names may not begin with them and may not contain them.

They are usually rendered as whitespace, and would lead to classic TR39 confusables.
See L<https://github.com/jagracey/Awesome-Unicode#user-content-variable-identifiers-can-effectively-include-whitespace> and L<http://www.unicode.org/reports/tr39/>.

In a more Korean friendly environment, we could check for a ID_Start Hangul
filler if the next character is a valid Hangul ID_Continue character,
and allow it then.  Ditto for a ID_Continue Hangul filler if the
previous and next character is a valid Hangul ID_Start or ID_Continue
character, and allow it then.
But those fillers should be treated as whitespace, and should be ignored.

L<http://www.unicode.org/L2/L2006/06310-hangul-decompose9.pdf> explains:

I<< The two other hangul fillers HANGUL CHOSEONG FILLER (Lf),
i.e. lead filler, and HANGUL JUNGSEONG FILLER (Vf) are used as
placeholders for missing letters, where there should be at least one
letter. >>

I<< ... that leaves the (HALFWIDTH) HANGUL FILLERs useless. Indeed,
they should not be rendered at all, despite that they have been given
the property Lo. Note that these FILLERs are also given the property
of Default_Ignorable_Codepoint. >>

I<< Note that the standard normal forms NFKD and NFKC ... return (in
all views) incorrect results for strings containing these
characters. >>

=head1 Modules and Pragmata

=head2 Updated Modules and Pragmata

=over 4

<<<<<<<
=======
=item XSLoader 1.02c

Fixed the C<#line relativefilename> part of the
L<[cpan #115808]|https://rt.cpan.org/Ticket/Display.html?id=115808> security
problem, the C<(eval 1)> part was already fixed in the cperl rewrite as
XS.

Ensure that the local stash filename part is absolute and ends with C</>,
the part before "auto/" and before the fallback to the DynaLoader search.

=item Net::Cmd

Fixed utf8 handling, suse L<[bnc#493978]|https://bugzilla.opensuse.org/show_bug.cgi?id=493978>

Note that libnet has hundreds of more L<open tickets|https://rt.cpan.org/Dist/Display.html?Name=libnet>

=item Pod::Perldoc

Favor nroff over groff, suse perl-nroff.diff [bnc#463444]

=item Socket 2.021_02

Silence some CC warnings

Fix my to our $XS_VERSION

Check for max length before derefing by length (jhi)
L<[cpan #111707]|https://rt.cpan.org/Ticket/Display.html?id=111707>

=item DynaLoader 2.04c

See L</DynaLoader format string hardening> above.

=item B::C 1.54_08

Many Windows and cygwin fixes, for the old MSVC compiler, and
PERL_CORE test integration. Use many new core exports needed for
windows.

Update perlcc to 2.21, handle multiple -I and -L arguments.

Handle cperl OP_SIGNATURE.

Fix refcount of cop hints hashes with 5.22-nt
L<[cperl #220]|https://github.com/perl11/cperl/issues/220>

Better UVX L and U suffices.

Handle shared IV and UV xpv structs,
  fixed 5.24 specific assertions, with shared xpviv/xpvuv.
  fixed wrong 32 bit ptr offset. re-enabled all 32bit tests.

Handle changed subdirs-test target with newer EUMM.

=item B::Deparse 1.37_02c

Add more cperl-specific ops: C<aelem*_u>, C<u_{add,subtract,multiply}>,
C<{i,n,s}_aelem{,_u}>

=item Test::Simple 1.401014c

Based on 1.001014, not Test2 as in 1.302022 yet. Test2 breaks too many
modules still, and I need to time to properly modernize it (as v2.x)

Modernized and stricter type checks.
B<skip> does the switched argument check at compile-time.
See the FAQ at L<http://perl11.org/cperl/STATUS.html> why we enforce
stricter types there.

Enable F<t/is_deeply_with_threads.t>

=item File-Path 3.12_01c

Modernized. Enforce many str types.

=item PathTools 4.63c

Modernized. Enforce many str types.

Enable XS prototypes and suppress warnings.
L<[cperl #152]|https://github.com/perl11/cperl/issues/152>

Disallow the optional getcwd argument (5.8.5 problem).
Cannot be called as method.

=item Pod-Simple 4.30c

Modernized

=item Pod-Html 2.22c

Modernized

=item bignum 0.42c

Modernized

=item bigint 0.43c

Modernized.
Fixed deprecated usage of ::binf, ::bnan as function.

=item bigrat 0.42c

Modernized

=item CPAN

Fixed tests. Type skip calls and File-Path args.

Change FirstTime yaml_module default from YAML to YAML::XS
and prohibit the unsupported CPAN::Meta::YAML.

=item ExtUtils-MakeMaker

Type File-Path args.

Fix ExtUtils::Liblist::Kid for systemlib symlinks, esp. on darwin.

=item Parse-CPAN-Meta 1.5000c

Modernized.
str type for skip

=item CPAN-Meta 2.150005c

fix Encode test for modernized Test-Simple,
stringify the 1st skip arg

=item CPAN::Meta::Requirements 3.140c

=item Test-Harness 3.36

type the skip calls

=item Hash-Util-FieldHash

type the skip calls

=item YAML-LibYAML 0.70

Spiffy and Test::Base 0.88c fixes for fake signatures.

Spiffy uses a source filter to expand many methods,
but this does not work with fake_signatures.
Expand the compile-time state of Test::Base to avoid
source filters.
Also add . to @INC in some tests.

utf-8 handling stills throws many warnings.

=item Filter-Util-Call 0.92

Fixed 1 test for signature errmsg

=item IO-Compress

Fixed 1 test for signature errmsg

=item Devel-Peek 1.23

Skip tests for changed dynamic prototype() with sigs.
Fix tests with -DDEBUG_LEAKING_SCALARS

=item B 1.62_02

add B::OP::rettype, B::OP::typechecked,
B::CV::SIGOP and support for OP_SIGNATURE with B::UNOP_AUX::aux_list
and B::UNOP_AUX::string.

Note: With threads in B::UNOP_AUX::aux_list the padoffsets are returned as such,
and not as SV. This is different to upstream perl5, a perl5 bug.

=item Devel-NYTProf 6.03

fix test for short CV_NAME_NOMAIN.
silence a C compiler warning.

=item perl5db 1.49_04c

fix test for short CV_NAME_NOMAIN.
run-time load IO::Handle, broke miniperl.
handle calls to signatures via goto, and add tests.

=item Digest::MD5 2.55_01

=item warnings 1.35

Add category C<types>.

Disable 3 experimental warnings which are now default with cperl.

=item Archive::Tar 2.08

Added t/09_roundtrip.t

=item Config 6.21

Various minor fixes

>>>>>>>
=item Config::Perl::V 0.26_01

cperl patches.
Add tests for 5.22 and 5.24.
Support some multi-line keys: ccflags ldflags lddlflags
Changed tests to use done_testing().

=item Cpanel::JSON::XS 3.0217

Improve error message with class based method calls,
when forgetting ->new. L<[#66]|https://github.com/rurban/Cpanel-JSON-XS/issues/66>

Fix a off-by-one IV_MIN -> NV overflow in decode_json.
L<[#67]|https://github.com/rurban/Cpanel-JSON-XS/issues/67> (xdg)

Avoid encode_sv SEGV with -Dusequadmath.
L<[#62]|https://github.com/rurban/Cpanel-JSON-XS/issues/62>
Fix quadmath NV stringification.

Preserve numbers as numbers, enforce an added C<.0> (xdg).
Also note that 42+"bar" will result >=5.10 in numbers not integers,
=> 42.0

=item Devel::PPPort 3.33_02

Support the latest versions.

cperl specific:
Minor -Dfortify_inc fixes, kept our Hv macros,
fix __attribute__((warn_unused_result)) on windows.

=item Socket 2.021_02

Silence some CC warnings

Fix my to our $XS_VERSION

Check for max length before derefing by length (jhi) RT #111707

=item DynaLoader 2.04c

See L</DynaLoader format string hardening> above.

Silence some CC warnings, add changelog.

=item Storable

Silence some CC warnings, esp. on 32bit.

=item B-C 1.54_07

Silence some CC warnings, esp. on 32bit.

=item Config 6.21

Improvements from cperl-5.24:

    -fix for readonly Makefile.PL (in core src tarballs)
    -fix wrong SKIP headers
    -skip in core make regen tests (--tap)
    -more 5.24 and cperl keys
    -silence unused classname compiler warning
    -link to Mock::Config in the docs to temp. write to %Config in tests.
    -Dfortify_inc fixes

-regen the XSConfig.t/Config_xs.PL key lists

-remove now generated/range operator-ed config_arg keys from XSConfig.t
 they are redundant

-add common keys d_memmem d_uselocale d_freelocale d_newlocale to CPAN

-clean build product Config_xs_tmp.in

-PERL_UNUSED_ARG fix for 5.8.7

-Silence some CC warnings.

=item libnet 3.08

With our Net::Domain patch for darwin.
Improved utf8 and ipv6 support.

=item Pod::Checker 1.73

Now based on Pod::Simple, not on Pod::Parser anymore.
dos2unix

=item Devel-NYTProf

Silence some CC warnings.

=item Digest-MD5

Improve C<d_u32align> diagnostic message

=back

=head1 Utility Changes

XXX Changes to installed programs such as F<perlbug> and F<xsubpp> go here.
Most of these are built within the directory F<utils>.

[ List utility changes as a =head2 entry for each utility and =item
entries for each change. ]

=head2 F<installperl>

=over 4

=item *

Fixed regression from 5.22.1c for windows.

=back

=head1 Configuration and Compilation

XXX Changes to F<Configure>, F<installperl>, F<installman>, and analogous tools
go here.  Any other changes to the Perl build process should be listed here.
However, any platform-specific changes should be listed in the
L</Platform Support> section, instead.

[ List changes as a =item entry ].

=over 4

=item *

Added a C<make archclean> target for POSIX platforms, which does not require
a new C<Configure> call.

=back

=head1 Platform Support

XXX Any changes to platform support should be listed in the sections below.

[ Within the sections, list each platform as a =item entry with specific
changes as paragraphs below it. ]

=head2 Platform-Specific Notes

XXX List any changes for specific platforms.  This could include configuration
and compilation changes or changes in portability/compatibility.  However,
changes within modules for platforms should generally be listed in the
L</Modules and Pragmata> section.

=over 4

=item XXX-some-platform

XXX

=back

=head1 Internal Changes

XXX Changes which affect the interface available to C<XS> code go here.  Other
significant internal changes for future core maintainers should be noted as
well.

[ List each change as a =item entry ]

=over 4

=item *

XXX

=back

=head1 Selected Bug Fixes

XXX Important bug fixes in the core language are summarized here.  Bug fixes in
files in F<ext/> and F<lib/> are best summarized in L</Modules and Pragmata>.

[ List each fix as a =item entry ]

=over 4

=item *

XXX

=back

=head1 Known Problems

XXX Descriptions of platform agnostic bugs we know we can't fix go here.  Any
tests that had to be C<TODO>ed for the release would be noted here.  Unfixed
platform specific bugs also go here.

[ List each fix as a =item entry ]

=over 4

=item *

XXX

=back

=head1 Errata From Previous Releases

=over 4

=item *

XXX Add anything here that we forgot to add, or were mistaken about, in
the perldelta of a previous release.

=back

=head1 Acknowledgements

cperl 5.22.4 represents approximately 1 week of development since cperl 5.22.3
and contains approximately 1,300 lines of changes across 55 files from 1
author.

Excluding auto-generated files, documentation and release tools, there were
approximately 86 lines of changes to 12 .pm, .t, .c and .h files.

The following people are known to have contributed the improvements
that became cperl 5.22.4:

Reini Urban.

The list above is almost certainly incomplete as it is automatically generated
from version control history. In particular, it does not include the names of
the (very much appreciated) contributors who reported issues to the Perl bug
tracker.

Many of the changes included in this version originated in the CPAN modules
included in Perl's core. We're grateful to the entire CPAN community for
helping Perl to flourish.

For a more complete list of all of Perl's historical contributors, please see
the F<AUTHORS> file in the Perl source distribution.

=head1 Reporting Bugs

If you find what you think is a bug, you might check the articles recently
posted to the comp.lang.perl.misc newsgroup and the perl bug database at
https://rt.perl.org/ .  There may also be information at
http://www.perl.org/ , the Perl Home Page.

If you believe you have an unreported bug, please run the F<perlbug> program
included with your release.  Be sure to trim your bug down to a tiny but
sufficient test case.  Your bug report, along with the output of C<perl -V>,
will be sent off to perlbug@perl.org to be analysed by the Perl porting team.

If you think it's a cperl specific bug or trust the cperl developers more 
please file an issue at L<https://github.com/perl11/cperl/issues>.

If the bug you are reporting has security implications, which make it
inappropriate to send to a publicly archived mailing list, then please send it
to perl5-security-report@perl.org.  This points to a closed subscription
unarchived mailing list, which includes all the core committers, who will be
able to help assess the impact of issues, figure out a resolution, and help
co-ordinate the release of patches to mitigate or fix the problem across all
platforms on which Perl is supported.  Please only use this address for
security issues in the Perl core, not for modules independently distributed on
CPAN.

If you trust the cperl developers more, please send an email to
them. The p5p security teams skips many security issues, or are
unwilling to fix them.

=head1 SEE ALSO

The F<Changes> file for an explanation of how to view exhaustive details on
what changed.

The F<INSTALL> file for how to build Perl.

The F<README> file for general stuff.

The F<Artistic> and F<Copying> files for copyright information.

=cut
